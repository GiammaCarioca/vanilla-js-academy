<!DOCTYPE html>
<html>
	<head>
		<title>Form Autosave</title>

		<style type="text/css">
			body {
				margin: 1em auto;
				max-width: 40em;
				width: 88%;
			}

			label,
			input,
			textarea {
				display: block;
				width: 100%;
			}

			input,
			textarea {
				margin-bottom: 1em;
			}

			textarea {
				height: 8em;
			}
		</style>
	</head>
	<body>
		<h1>Form Autosave</h1>

		<form class="save-me" id="save-me">
			<label for="name">Name</label>
			<input type="text" name="name" id="name" />

			<label for="address">Address</label>
			<input type="text" name="address" id="address" />

			<label for="email">Email</label>
			<input type="email" name="email" id="email" />

			<label id="more">Additional thoughts?</label>
			<textarea name="more" id="more"></textarea>

			<p>
				<button type="submit">Submit</button>
			</p>
		</form>

		<script>
			const form = document.querySelector('#save-me')

			const saveFormData = evt => {
				if (!evt.target.matches('input')) return
				localStorage.setItem(evt.target['name'], evt.target.value)
			}

			const handleSubmit = evt => {
				if (!evt.target.closest('form').matches('#save-me')) return
				localStorage.clear()
			}

			const populateForm = _ => {
				for (let item in localStorage) {
					if (localStorage.hasOwnProperty(item)) {
						form.children[item].value = localStorage.getItem(item)
					}
				}
			}

			populateForm()

			form.addEventListener('input', saveFormData, false)
			form.addEventListener('submit', handleSubmit, false)
		</script>
	</body>
</html>
